clc;
clear all;
i = sqrt(-1);
Y = [2.2-9i -1+5i -1.2+4i 0;-1+5i 2.6-11i -0.5+4i -1.1+2i; -1.2+4i -0.5+4i 2.9-11i -1.2+3i; 0 -1.1+2i -1.2+3i 2.3-5i];
V_10 = 1.06+0i;
V_20 = 1.04+0i;
V_30 = 1+0i;
V_40 = 1+0i;
V_11 = V_10;
% Bus 2
Q_21 = -1*(V_20)*[(Y(2,1)*V_11)+(Y(2,2)*V_20)+(Y(2,3)*V_30)+(Y(2,4)*V_40)]
Q_21 = imag(Q_21);
if (Q_21 <0.1)
    Q_21= 0.1;
elseif (Q_21>1.0)
    Q_21 = 1.0;
end
P_2= 0.5;
Q_2=Q_21;
V_21= [ ( ((P_2-(Q_2 *i))) / (V_20)) - (Y (2,1) *V_11) - (Y (2,3) *V_30) - (Y (2, 4) *V_40) ]/(Y(2,2));
A= atan (imag (V_21)/real(V_21));
V_21 = V_20* (cos (A) + (sin (A) *i))
%Bus 3

P_3 = 0.4;

Q_3 = 0.3;

V_31 = [1/Y(3,3)] *[((P_3-(Q_3*i))/ (V_30) ) - (Y(3, 1) *V_11) - (Y (3,2) *V_21) - (Y (3,4) *V_40) ]
% Bus 4

P_4 = 0.2;

Q_4=0.1;

V_41 = (1/Y(4,4))*[(P_4-(Q_4*i))-(Y(4,1)*V_11)-(Y(4,2)*V_21)-(Y(4,3)*V_31)]